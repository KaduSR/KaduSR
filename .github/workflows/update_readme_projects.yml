name: Atualizar README com repositÃ³rios

on:
  schedule:
    - cron: "0 0 * * 1" # roda toda segunda-feira
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Buscar repositÃ³rios
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { data: repos } = await github.repos.listForUser({
              username: "KaduSR",
              sort: "updated",
              direction: "desc",
              per_page: 5
            });

            const fs = require("fs");
            let content = "### ðŸš€ Projetos Recentes\n\n";
            for (const repo of repos) {
              content += `- [${repo.name}](${repo.html_url})\n`;
              if (repo.description) {
                content += `  > ${repo.description}\n\n`;
              }
            }

            let readme = fs.readFileSync("README.md", "utf8");
            readme = readme.replace(
              /<!-- PROJECT-LIST:START -->([\\s\\S]*?)<!-- PROJECT-LIST:END -->/,
              `<!-- PROJECT-LIST:START -->\n${content}<!-- PROJECT-LIST:END -->`
            );
            fs.writeFileSync("README.md", readme);

      - name: Commit e push
        run: |
          git config user.name "blog-post-bot"
          git config user.email "blog-post-bot@example.com"
          git add README.md
          git commit -m "chore: atualizar lista de projetos"
          git push
